name: campus-north

topology:
  nodes:
    # Backbone (Area 0): r1â€“r4
    r1:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r1/daemons:/etc/frr/daemons
        - ./r1/vtysh.conf:/etc/frr/vtysh.conf
        - ./r1/frr.conf:/etc/frr/frr.conf
    r2:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r2/daemons:/etc/frr/daemons
        - ./r2/vtysh.conf:/etc/frr/vtysh.conf
        - ./r2/frr.conf:/etc/frr/frr.conf
    r3:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r3/daemons:/etc/frr/daemons
        - ./r3/vtysh.conf:/etc/frr/vtysh.conf
        - ./r3/frr.conf:/etc/frr/frr.conf
    r4:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r4/daemons:/etc/frr/daemons
        - ./r4/vtysh.conf:/etc/frr/vtysh.conf
        - ./r4/frr.conf:/etc/frr/frr.conf

    # Area 1: ABR r5 + internal r6
    r5:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r5/daemons:/etc/frr/daemons
        - ./r5/vtysh.conf:/etc/frr/vtysh.conf
        - ./r5/frr.conf:/etc/frr/frr.conf
    r6:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r6/daemons:/etc/frr/daemons
        - ./r6/vtysh.conf:/etc/frr/vtysh.conf
        - ./r6/frr.conf:/etc/frr/frr.conf

    # Area 2: ABR r7 + internal r8
    r7:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r7/daemons:/etc/frr/daemons
        - ./r7/vtysh.conf:/etc/frr/vtysh.conf
        - ./r7/frr.conf:/etc/frr/frr.conf
    r8:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r8/daemons:/etc/frr/daemons
        - ./r8/vtysh.conf:/etc/frr/vtysh.conf
        - ./r8/frr.conf:/etc/frr/frr.conf

    # External routers
    r9:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r9/daemons:/etc/frr/daemons
        - ./r9/vtysh.conf:/etc/frr/vtysh.conf
        - ./r9/frr.conf:/etc/frr/frr.conf
    r10:
      kind: linux
      image: quay.io/frrouting/frr:8.4.2
      binds:
        - ./r10/daemons:/etc/frr/daemons
        - ./r10/vtysh.conf:/etc/frr/vtysh.conf
        - ./r10/frr.conf:/etc/frr/frr.conf

    # PCs
    pc1:
      kind: linux
      image: alpine:latest
    pc2:
      kind: linux
      image: alpine:latest
    pc3:
      kind: linux
      image: alpine:latest
    pc4:
      kind: linux
      image: alpine:latest

  links:
    # Backbone full mesh (Area 0 - AS 65100)
    - endpoints: ["r1:eth1", "r2:eth1"]
    - endpoints: ["r1:eth2", "r3:eth1"]
    - endpoints: ["r1:eth3", "r4:eth1"]
    - endpoints: ["r2:eth2", "r3:eth2"]
    - endpoints: ["r2:eth3", "r4:eth2"]
    - endpoints: ["r3:eth3", "r4:eth3"]

    # eBGP links from Backbone to external ASes
    - endpoints: ["r1:eth4", "r5:eth1"]    # R1 (AS 65100) <-> R5 (AS 65101)
    - endpoints: ["r2:eth4", "r7:eth1"]    # R2 (AS 65100) <-> R7 (AS 65102)
    - endpoints: ["r3:eth4", "r10:eth1"]   # R3 (AS 65100) <-> R10 (AS 65104 - ISP)
    - endpoints: ["r4:eth4", "r9:eth1"]    # R4 (AS 65100) <-> R9 (AS 65103)

    # Area 1 internal (AS 65101)
    - endpoints: ["r5:eth2", "r6:eth1"]    # R5 <-> R6 (iBGP)
    - endpoints: ["r6:eth2", "pc1:eth1"]   # PC1 connection
    - endpoints: ["r6:eth3", "pc2:eth1"]   # PC2 connection

    # Area 2 internal (AS 65102)
    - endpoints: ["r7:eth2", "r8:eth1"]    # R7 <-> R8 (iBGP)
    - endpoints: ["r8:eth2", "pc3:eth1"]   # PC3 connection
    - endpoints: ["r8:eth3", "pc4:eth1"]   # PC4 connection
